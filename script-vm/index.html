<script src="u32_rrot7.js"></script>
<script src="u32_rrot8.js"></script>
<script src="u32_rrot16.js"></script>
<script src="u32_rrot12.js"></script>
<script src="u32_zip.js"></script>
<script src="u32_add.js"></script>
<script src="u32_xor.js"></script>
<script src="u32_push.js"></script>
<script>


// The Blake3 "quarter round"
const program = [
    
    // Initialize our lookup table
    u32_push_xor_table,


    // The six inputs a, b, c, d, m0, m1

    // m1
    u32_push(6),
    // m0
    u32_push(5),
    // d
    u32_push(4),
    // c
    u32_push(3),
    // b
    u32_push(2),
    // a
    u32_push(1),


    //
    // Program
    //

    // Stack:  m1 m0 d c b a  |

    // z = a+b+m0 
    u32_pick(1),
    u32_zip(0, 1),
    u32_add(),
    u32_zip(0, 4),
    u32_add(),
    // Stack:  m1 d c b  |  z

    // y = (d^z) >>> 16
    u32_pick(0),
    u32_zip(0, 4),
    u32_xor(6),
    u32_rrot16,
    // Stack:  m1 c b  |  z y

    // x = y+c
    u32_pick(0),
    u32_zip(0, 4),
    u32_add(),
    // Stack:  m1 b  |  z y x

    // w = (b^x) >>> 12
    u32_pick(0),
    u32_zip(0, 4),
    u32_xor(6),
    u32_rrot12,
    // Stack:  m1  |  z y x w

    // v = z+w+m1
    u32_pick(0),
    u32_zip(0, 4),
    u32_add(),
    u32_zip(0, 4),
    u32_add(),
    // Stack:  |  y x w v

    // u = (y^v) >>> 8
    u32_pick(0),
    u32_zip(0, 4),
    u32_xor(5),
    u32_rrot8,
    // Stack:  |  x w v u

    // t = x+u
    u32_pick(0),
    u32_zip(0, 4),
    u32_add(),
    // Stack:  |  w v u t

    // s = (w^t) >>> 7
    u32_pick(0),
    u32_zip(0, 4),
    u32_xor(5),
    u32_rrot7,
    // Stack:  | v u t s



    //
    // Cleanup our stack to make the result more readable
    //
    u32_toaltstack,
    u32_toaltstack,
    u32_toaltstack,
    u32_toaltstack,

    u32_drop_xor_table,

    u32_fromaltstack,
    u32_fromaltstack,
    u32_fromaltstack,
    u32_fromaltstack

].join('')

console.log(program)

</script>