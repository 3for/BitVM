<h1>Open the Developer Console</h1>
<script type="module">
	import * as Esplora  from '../libs/esplora.js'
	import { Tap, Tx, Address, Signer } from '../libs/tapscript.js'
	// import { createActor, computeCblock } from '../transactions/utils.js' 

	
	function generateCircuit(outpoint){
		// TODO: implement me
		return {}
	}

	async function onTransaction(txid){
		console.log(txid)

		const nextTx = circuit[txid]
		if(!nextTx) return

		const prevTx = await Esplora.fetchTransaction(txid)
		console.log(prevTx)

		// Parse script parameters from transaction witness

		// await Esplora.broadcastTransaction(nextTx)
		console.log('broadcasted!')
	}


	async function startListening(){
		let prevHeight = await Esplora.fetchLatestBlockHeight() - 3
		console.log(`Started listening at height ${prevHeight}`)
		setInterval( async _ => {
			const latestHeight = await Esplora.fetchLatestBlockHeight()
			while( prevHeight < latestHeight ){
				const blockHash = await Esplora.fetchBlockAtHeight(prevHeight + 1)
				const txids = await Esplora.fetchTXIDsInBlock(blockHash)
				for (const txid of txids) onTransaction(txid)
				prevHeight += 1
			}
		}, 15000)
	}


	const circuit = generateCircuit({
		txid: '02d812bd8077238862bb91ea382a839d1c36aee685a004b1eb3058c652352e40',
		vout: 1,
		value: 100000
	})

	startListening()
</script>