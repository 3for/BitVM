<script type="module">
    import { connect } from '../server/socket.js'
	import {
		protocol, 
		MSG_TYPE_HAND,
		USER_PAUL,
		USER_VICKY
	} from './protocol.js'

	import { VM } from './vm.js'
	import { program, data } from './dummy-program.js'

	import { VickyBitVMClient } from './bitvm-client.js'

	import { fetchUnspentOutputs } from '../libs/esplora.js'
	import { fetchJson } from '../libs/common.js'
	
	// const preimages = await fetchJson('paul-preimages.json')
	
	console.log('Trying to fetch an output...')
    const fundingAddress = 'tb1p9evrt83ma6e2jjc9ajagl2h0kqtz5y05nutg2xt2tn9xjcm29t0slwpyc9'
    const outpoint = (await fetchUnspentOutputs( fundingAddress )).filter(utxo => utxo.value == 1_000_000)[0]
    if(!outpoint) 
    	throw `You have to charge the contract with 1'000'000 sats! \n ${fundingAddress}`
    
    const vm = new VM(program, data)

	const client = new VickyBitVMClient(vm, outpoint, await fetchJson('paul.json'))
	
	client.listen()

</script>
