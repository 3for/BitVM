<script type="module">
	import  * as Esplora  from '../libs/esplora.js'

	let prevHeight = await Esplora.fetchLatestBlockHeight()

	setInterval( async _ => {
		console.log('Started listening')
		const latestHeight = await Esplora.fetchLatestBlockHeight()
		
		while( prevHeight < latestHeight ){
			const blockHash = await Esplora.fetchBlockAtHeight(prevHeight + 1)
			const txids = await Esplora.fetchTXIDsInBlock(blockHash)
			for (const txid of txids) {
				const tx = await Esplora.fetchTransaction(txid)
				console.log(tx)
			}

			prevHeight += 1
		}

	}, 15000)
</script>