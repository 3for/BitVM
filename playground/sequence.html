<script type="module">
	import {compileSequence, Leaf} from '../transactions/leaf.js'
	import { challengeResponseSequence, justiceRoot } from '../transactions/reveal-sequence.js'
	import { merkleSequence } from '../transactions/merkle-sequence.js'
	import { Player } from '../opcodes/player.js'

class DummyLeaf extends Leaf {
    lock(foo){
        return [
            foo,
            OP_DROP,
            OP_DROP,
            OP_TRUE
        ]
    }

    unlock(value){
        return [
            value
        ]
    }
}

class OtherDummyLeaf extends Leaf {
    lock(verifier, prover){
        return [
        	OP_DROP,
        	verifier.pubkey,
            OP_CHECKSIGVERIFY,
            prover.pubkey,
            OP_CHECKSIG
        ]
    }

    unlock(verifier, prover, value){
        return [
    		this.sign(prover),
    		this.sign(verifier),
            value,
        ]
    }
}



window.paul = new Player('d898098e09898a0980989b980809809809f09809884324874302975287524398')
window.vicky = new Player('a9bd8b8ade888ed12301b21318a3a73429232343587049870132987481723497')

const outpoint = {
    txid : '249b2711c2eb4301c644770d6cd845a0570391cb8c638514aee50ce2d63f0914',
    vout : 0,
    value: 100000
}

const finalAddress = 'tb1pq7u2ujdvjzsy36d4xdt6yd2txv6wnj97aqf7ewvwnxn7ql5v8w3sg98j36'

// const sequence = [
//     [ [DummyLeaf, 12], [OtherDummyLeaf, vicky, paul ] ],
//     [ [DummyLeaf, 7], [DummyLeaf, 42], [DummyLeaf, 19] ],
//     [ [DummyLeaf, 7], [DummyLeaf, 42], [DummyLeaf, 19] ],
//     [ [DummyLeaf, 7], [DummyLeaf, 42], [DummyLeaf, 19] ],
// ]

// const sequence = challengeResponseSequence(vicky, paul, 'my-identifier', 7)
const sequence = merkleSequence(vicky, paul)

window.txs = compileSequence(sequence, outpoint, finalAddress)

console.log(txs[0].address())
console.log(txs)

</script>