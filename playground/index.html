<script type="module">
    import { keys } from '../libs/crypto_tools.js'
    import { toPublicKey } from '../transactions/utils.js'
    import { createChallengeResponseChain, presignChallengeResponseChain, revealTxChain } from '../transactions/reveal-challenge.js'
   

    const paul = {
        secret: 'd898098e09898a0980989b980809809809f09809884324874302975287524398',
    }
    paul.seckey = keys.get_seckey(paul.secret)
    paul.pubkey = toPublicKey(paul.seckey)

    const vicky = {
        secret: 'a9bd8b8ade888ed12301b21318a3a73429232343587049870132987481723497',
    }
    vicky.seckey = keys.get_seckey(vicky.secret)
    vicky.pubkey = toPublicKey(vicky.seckey)

    const funding_txid = '6910f55fa54564babbcd3b17f1e9a0b74ebdf75ce06fa51f0acd435e1d5e525f'
    const funding_vout = 0
    const tx_chain = createChallengeResponseChain(funding_txid, funding_vout, paul, vicky, 4, 'my-challenge')
    console.log('Address to fund: ', tx_chain[0].address)
    console.log('Amount: ', tx_chain[0].tx.vin[0].prevout.value)
    presignChallengeResponseChain(tx_chain, paul.seckey, vicky.seckey)
    
    // TODO The calls here are not sequential
    await revealTxChain(tx_chain, 0, vicky.secret, 1)
    await revealTxChain(tx_chain, 1, paul.secret, 'deadbeefdeadbeefdeadbeefdeadbeefdeadbeef')
    await revealTxChain(tx_chain, 2, vicky.secret, 0)
    await revealTxChain(tx_chain, 3, paul.secret, 'beefdeadbeefdeadbeefdeadbeefdeadbeefdead')
    // Could go on with another 4 txs
</script>
